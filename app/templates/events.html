<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eventos ğŸ“…</title>

  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#fdf2f8] min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-white shadow p-4 text-center font-semibold">
  ğŸ“… Calendario
</header>

<!-- MAIN -->
<main class="flex-1 p-4 pb-28 space-y-6">

  <!-- AGREGAR EVENTO -->
  <section class="bg-white rounded-xl p-4 shadow space-y-2">
    <h2 class="font-semibold text-gray-700">â• Nuevo evento</h2>

    <input id="title" placeholder="TÃ­tulo del evento"
      class="w-full border rounded-lg p-2" />

    <input id="date" type="date"
      class="w-full border rounded-lg p-2" />

    <button onclick="addEvent()"
      class="w-full bg-pink-400 text-white py-2 rounded-xl font-semibold">
      Guardar evento
    </button>
  </section>

  <!-- CALENDARIO -->
  <section class="bg-white rounded-xl p-4 shadow">
    <div class="flex justify-between items-center mb-3">
      <button onclick="prevMonth()">â—€</button>
      <h2 id="monthLabel" class="font-semibold"></h2>
      <button onclick="nextMonth()">â–¶</button>
    </div>

    <div class="grid grid-cols-7 text-center text-xs text-gray-500 mb-2">
      <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
    </div>

    <div id="calendar" class="grid grid-cols-7 gap-1 text-sm"></div>
  </section>

  <!-- EVENTOS DEL DÃA -->
  <section class="bg-white rounded-xl p-4 shadow">
    <h2 class="font-semibold text-gray-700 mb-2">
      ğŸ“Œ Eventos del dÃ­a
    </h2>
    <ul id="eventsList" class="space-y-2 text-sm"></ul>
  </section>

</main>

<!-- NAVBAR -->
<nav class="fixed bottom-0 inset-x-0 bg-white border-t flex justify-around py-2 text-xs">
  <a href="/" class="text-gray-500">ğŸ  Inicio</a>
  <a href="/app/events" class="text-pink-400">ğŸ“… Eventos</a>
  <a href="/app/workouts" class="text-gray-500">ğŸ‹ï¸ Gym</a>
  <a href="/app/notes" class="text-gray-500">ğŸ“ Notas</a>
</nav>

<script>
let events = []
let currentDate = new Date()
let selectedDate = null

/* ============================
   API
============================ */

async function loadEvents() {
  const res = await fetch('/events')
  events = await res.json()
  renderCalendar()
}

async function addEvent() {
  if (!title.value || !date.value) return

  await fetch('/events', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      title: title.value,
      event_date: date.value
    })
  })

  title.value = ''
  loadEvents()
}

/* ============================
   CALENDAR
============================ */

function renderCalendar() {
  calendar.innerHTML = ''

  const year = currentDate.getFullYear()
  const month = currentDate.getMonth()

  monthLabel.textContent = currentDate.toLocaleDateString('es-ES', {
    month: 'long',
    year: 'numeric'
  })

  const firstDay = new Date(year, month, 1)
  const startDay = (firstDay.getDay() + 6) % 7
  const daysInMonth = new Date(year, month + 1, 0).getDate()

  for (let i = 0; i < startDay; i++) {
    calendar.innerHTML += `<div></div>`
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`
    const hasEvent = events.some(e => e.date === dateStr)

    const div = document.createElement('div')
    div.textContent = day
    div.onclick = () => selectDate(dateStr)

    div.className = `
      p-2 rounded-lg cursor-pointer
      ${hasEvent ? 'bg-pink-200 font-semibold' : 'hover:bg-pink-100'}
    `

    calendar.appendChild(div)
  }
}

function selectDate(dateStr) {
  selectedDate = dateStr
  eventsList.innerHTML = ''

  const dayEvents = events.filter(e => e.date === dateStr)

  if (dayEvents.length === 0) {
    eventsList.innerHTML = `<li class="text-gray-400">No hay eventos</li>`
    return
  }

  dayEvents.forEach(e => {
    const li = document.createElement('li')
    li.textContent = `ğŸ“Œ ${e.title}`
    eventsList.appendChild(li)
  })
}

function prevMonth() {
  currentDate.setMonth(currentDate.getMonth() - 1)
  renderCalendar()
}

function nextMonth() {
  currentDate.setMonth(currentDate.getMonth() + 1)
  renderCalendar()
}

loadEvents()
</script>

</body>
</html>
